<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
  </head>
  <body>
    <style>
      .edit-area {
        display: flex;
        flex-direction: row;
      }

      .input {
        width: 50%;
      }

      .output {
        width: 50%;
        margin-left: 10px;
        height: 300px;
        overflow: scroll;
        border: 1px black solid;
      }

      .buttons-container {
        display: flex;
        flex-direction: row;
      }

      .buttons {
        width: 50%;
      }
    </style>
    <dvi>
      <p>Paste your HTML syntax:</p>
      <div class="edit-area">
        <textarea class="input" id="htmlSyntax" rows="20"></textarea>
        <textarea
          class="output"
          id="stringOutput"
          rows="20"
          readonly
        ></textarea>
      </div>
      <div class="buttons-container">
        <div class="buttons">
          <button onclick="ConvertAndShowOutPut()">Convert to String</button>
        </div>
        <div class="buttons">
          <button id="btnString" onclick="copyOutPut(this)">Copy</button>
        </div>
      </div>
    </dvi>
    <div>
      <p>Paste your string:</p>
      <div class="edit-area">
        <textarea class="input" id="cleanString" rows="20"></textarea>
        <textarea
          class="output"
          id="cleanString_output"
          rows="20"
          readonly
        ></textarea>
      </div>
      <div class="buttons-container">
        <div class="buttons">
          <button onclick="StringToHTML()">Convert to HTML</button>
        </div>
        <div class="buttons">
          <button id="btnHTML" onclick="copyOutPut(this)">Copy</button>
        </div>
      </div>
    </div>
  </body>
  <script>
    function minifyHTML(html, opts = {}) {
      const options = {
        removeComments: true,
        collapseWhitespace: true,
        preserveTags: ['pre', 'code', 'textarea'],
        ...opts,
      };

      if (!html || typeof html !== 'string') return '';

      // 1) Pull out content that must be preserved (pre/code/textarea)
      const preserved = [];
      const tagGroup = options.preserveTags
        .join('|')
        .replace(/[.*+?^${}()|[\]\\]/g, '\\$&');

      const preserveRe = new RegExp(
        `<(${tagGroup})\\b[^>]*>[\\s\\S]*?<\\/\\1>`,
        'gi'
      );

      html = html.replace(preserveRe, (m) => {
        const i = preserved.length;
        preserved.push(m);
        return `___PRESERVE_${i}___`;
      });

      // 2) Optionally remove comments (keep conditional comments like <!--[if ...]> )
      if (options.removeComments) {
        html = html.replace(/<!--(?!\s*\[if|\s*<!\[endif)[\s\S]*?-->/gi, '');
      }

      // 3) Normalize line breaks to spaces so we can collapse cleanly
      html = html.replace(/\r?\n/g, ' ');

      if (options.collapseWhitespace) {
        // collapse runs of whitespace to a single space
        html = html.replace(/\s+/g, ' ');
      }

      // 4) Trim spaces between tags: "> <" -> "><"
      html = html.replace(/>\s+</g, '><');

      // 5) Tighten attribute spacing: ' = ' -> '=' (outside of quoted strings is hard, so we do a safe pass)
      //    This keeps quotes intact, just removes extra spaces around '=' when they exist.
      html = html.replace(/\s*=\s*/g, '=');

      // 6) Trim leading/trailing whitespace
      html = html.trim();

      // 7) Restore preserved blocks exactly as they were
      html = html.replace(
        /___PRESERVE_(\d+)___/g,
        (_, i) => preserved[Number(i)]
      );

      return html;
    }

    function htmlToConcatenatedString(html) {
      // Find all tags and text separately
      const parts = html.split(/(<\/?[^>]+>)/).filter(Boolean);

      // Wrap each part in quotes, and replace "" to '''
      const wrapped = parts.map((part) => `"${part.replaceAll('"', "'")}"`);

      // Join with +
      return wrapped.join('+\n');
    }

    function ConvertAndShowOutPut() {
      const firstElement = document.getElementById('htmlSyntax').value;

      let minifiedHTML = minifyHTML(firstElement);

      if (minifiedHTML) {
        const ConcatenatedString = htmlToConcatenatedString(minifiedHTML);
        const outPutTxt = document.getElementById('stringOutput');
        outPutTxt.value = ConcatenatedString;
        outPutTxt.style.whiteSpace = 'pre-wrap';
      }
    }

    function StringToHTML() {
      const cleanStringInput = document.getElementById('cleanString').value;
      const convertedHTML = cleanString(cleanStringInput);
      var cleanString_output = document.getElementById('cleanString_output');
      cleanString_output.value = convertedHTML;
    }

    function copyOutPut(e) {
      console.log(e.id);
      console.log(e.id == 'btnString');
      // Get the text field
      switch (e.id) {
        case 'btnString':
          var copyText = document.getElementById('stringOutput');
          break;
        case 'btnHTML':
          var copyText = document.getElementById('cleanString_output');
          break;
        default:
          break;
      }

      if (copyText) {
        // Select the text field
        copyText.select();
        copyText.setSelectionRange(0, 99999); // For mobile devices

        // Copy the text inside the text field
        navigator.clipboard.writeText(copyText.value);

        // Alert the copied text
        alert('Copied');
      }
    }

    function cleanString(jsString) {
      // Remove all " + " joins (quotes + pluses between strings)
      let cleaned = jsString.replace(/"\s*\+\s*"/g, '\n');

      // Remove leading and trailing quotes if present
      if (cleaned.startsWith('"')) cleaned = cleaned.slice(1);
      if (cleaned.endsWith('"')) cleaned = cleaned.slice(0, -1);

      return cleaned;
    }
  </script>
</html>
